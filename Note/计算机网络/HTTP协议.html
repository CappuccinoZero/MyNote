<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.2.0 (458672)"/><meta name="author" content="林"/><meta name="created" content="2019-09-26 10:35:58 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-10-09 08:30:54 +0000"/><title>HTTP协议</title></head><body><div>HTTP是基于TCP/IP通信协议的<span style="color: rgb(255, 38, 0);">应用层</span>协议</div><div><br/></div><div><span style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">HTTP 0.9</span></span></div><div>只有一个命令<span style="color: rgb(255, 38, 0); font-style: italic;">GET</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">GET /index.htmld</span></div></div><div><br/></div><div>协议规定，服务器只能返回HTML格式的字符串</div><div>服务器发送完就关闭连接</div><div><br/></div><div><span style="font-size: 18px;">HTTP 1.0</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>GET / HTTP/1.0</div><div>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5)</div><div>Accept: */*</div></div><div>除了可以发送文字，还可以发送图像，视频，二进制文件</div><div>引入了<span style="color: rgb(255, 38, 0);">POST</span>和<span style="color: rgb(255, 38, 0);">HEAD</span>命令</div><div>请求和回应，除了数据部分，还必须包括头信息（HTTP HEAD），用来描述元数据</div><div>还有：status code(状态码) 多字符支持 multi-part type(多部分发送) authorization(权限) cache(缓存) content encoding(内容编码)</div><div><br/></div><div>格式第一话请求命令，尾部必须加上协议的版本</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>HTTP/1.0 200 OK</div><div>Content-Type: text/plain</div><div>Content-Length: 137582</div><div>Expires: Thu, 05 Dec 1997 16:00:00 GMT</div><div>Last-Modified: Wed, 5 August 1996 15:55:28 GMT</div><div>Server: Apache 0.84</div><div><div><br/></div><div><br/></div></div><div>&lt;html&gt;</div><div>  &lt;body&gt;Hello World&lt;/body&gt;</div><div>&lt;/html&gt;</div></div><div>回应格式</div><div>头信息:  数据</div><div>第一行为协议版本+状态码+状态描述</div><div><br/></div><div>Content-type字段</div><div>告诉客户端返回的是什么类型的数据</div><div>如：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Content-type: text/html;charset=utf-8</div><div>Content-type: text/plain</div><div>Content-type: image/png</div><div>Content-type: video/mp4</div><div>Content-type: application/javascript</div><div>Content-type: application/zip</div></div><div><br/></div><div>也可以自定义返回数据</div><div>客户端可以通过<span style="color: rgb(255, 38, 0);">Accept: */*</span>来声明自己可以接受的数据</div><div><br/></div><div>数据可以压缩后再发送</div><div>可以通过<span style="color: rgb(255, 38, 0);">Content-Encoding </span>来告诉自己的压缩方法</div><div>客户端也可以通过<span style="color: rgb(255, 38, 0);">Accept-Encoding</span> 声明自己可以接受的压缩方式</div><div><br/></div><div>HTTP 1.0的缺点是建立一次连接只能发送一次数据，要想继续发送数据必须重新建立连接</div><div><br/></div><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">HTTP 1.1</span></font></div><div><br/></div><div>使用至今的HTTP连接</div><div><br/></div><div>引入了持久连接，确保TCP<span style="color: rgb(255, 38, 0);">默认</span>不关闭，可以被多个请求复用，不用声明<span style="color: rgb(255, 147, 0);">Connect: keep-alive</span></div><div>客户端和服务器发现对方一段时间没有活动，就会主动关闭连接</div><div>规范的做法是客户端发送<span style="color: rgb(255, 147, 0);"> Connect: close </span>要求服务器主动关闭连接</div><div><br/></div><div>引入了管道机制(pipelining) 在同一个TCP连接里，可以发送多个请求。</div><div>但是服务器还是会按照顺序处理请求</div><div>传送多个回应，就必须要使用<span style="color: rgb(255, 38, 0);">Content-Length </span>来声明本次回应的长度，超过长度的部分就会是下一个回应了</div><div><br/></div><div>但是如果是一些耗时的动态操作来说，必须所有操作完成才能发送，效率并不高</div><div>所以又引入了分块发送，用<span style="color: rgb(255, 38, 0);">流模式</span>替代<span style="color: rgb(255, 38, 0);">缓存模式</span></div><div>只要请求头包括  <span style="color: rgb(255, 38, 0);">Transfer-Encoding: chunked </span>就表明使用流模式</div><div><br/></div><div>1.1中还加入了许多动作方法</div><div>并且头信息加入<span style="color: rgb(255, 38, 0);">HOST</span>字段，用来表示域名信息，这样就能够访问同一服务器下的不同网站</div><div><br/></div><div>1.1虽然能够处理多个回应，但所有回应都是按顺序进行，如果前面的回应特别慢，就会产生<span style="color: rgb(255, 38, 0);">队头阻塞</span>，影响整体效率</div><div><br/></div><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">SPDY协议</span></font></div><div><span style="font-size: 14px;">Google为了解决HTTP1.1效率低下而自行研发的，最开始在Chrome上试用</span></div><div><span style="font-size: 18px;"><br/></span></div><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">HTTP 2协议/HTTPS</span></font></div><div><span style="font-size: 14px;">继承了SPDY的特性</span></div><div><span style="font-size: 18px;"><br/></span></div><div><span style="font-size: 14px;">二进制编码：1.1头信息使用文本(ascll)，数据可以使用文本或者二进制，2.0必须全部使用二进制，并且统称为frame(帧）：头信息帧，数据帧</span></div><div>HTTP 2可以自定义帧，并且已经定义了数十种帧，为将来的高级应用打好了基础。使用这种功能，文本解析就会麻烦很多。</div><div><br/></div><div>Multiplexing多工，1.1回应通常要按照顺序，但是2可以同时发送多个回应，并且不用一一对应，如处理一个请求，服务器发现非常耗时，就会发送已经处理好的部分，然后处理其他请求。</div><div><br/></div><div>因为HTTP2的数据上不按要求发送的，就必须标记某个数据是哪个请求的。</div><div>HTTP将每个请求或回应的数据包成为stream（流），并且为每个流一个唯一编号，规定客户端的编号必须是奇数，服务器必须是偶数</div><div><br/></div><div>1.1如果需要取消请求就必须关闭连接，2中可以发送RST-STREAM帧来取消请求，不用关闭TCP连接</div><div><br/></div><div><br/></div><div>HTTP2引入了头信息技术，头信息压缩后在发送，并且客户端和服务器能够共同维护一个头信息表，所有字段都必须存入这个表中并生成一个索引号，以后就不用重新发送发送同样字段，只需发送索引号，提高了速度</div><div><br/></div><div>HTTPs 还引入是server push(推送) 机制，可以主动向客户端发送数据。</div></body></html>