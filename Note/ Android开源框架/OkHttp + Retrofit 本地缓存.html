<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.2.0 (458672)"/><meta name="altitude" content="896.626953125"/><meta name="author" content="林"/><meta name="created" content="2019-08-24 14:52:12 +0000"/><meta name="latitude" content="24.41792297363281"/><meta name="longitude" content="98.57332310286189"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-08-24 15:00:47 +0000"/><title>OkHttp + Retrofit 本地缓存</title></head><body><div>只能缓存 Get 请求</div><div><br/></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #c792ea; font-style: italic;">private fun </span><span style="color: #82aaff;">okhttp3CacheTest</span><span style="color: #89ddff;">(){ </span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">    </span><span style="color: #c792ea; font-style: italic;">val </span><span style="color: #eeffe3;">cacheFile </span><span style="color: #89ddff;">= </span><span style="color: #82aaff;">File</span><span style="color: #89ddff;">(</span><span style="color: #eeffff; font-style: italic;">cacheDir</span><span style="color: #89ddff;">,</span><span style="color: #c3e88d;">"httpCache"</span><span style="color: #89ddff;">)</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">    </span><span style="color: #c792ea; font-style: italic;">val </span><span style="color: #eeffe3;">cacheSize </span><span style="color: #89ddff;">= </span><span style="color: #f78c6c;">1024 </span><span style="color: #89ddff;">* </span><span style="color: #f78c6c;">1024 </span><span style="color: #89ddff;">* </span><span style="color: #f78c6c;">10L </span><span style="color: #717cb4; font-style: italic;">// </span><span style="color: #717cb4; font-style: italic; font-family: 'Menlo';">缓存最大空间</span><span style="color: #717cb4; font-style: italic;">10MB</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #717cb4; font-style: italic;">    </span><span style="color: #c792ea; font-style: italic;">val </span><span style="color: #eeffe3;">cache </span><span style="color: #89ddff;">= </span><span style="color: #82aaff;">Cache</span><span style="color: #89ddff;">(</span><span style="color: #eeffe3;">cacheFile</span><span style="color: #89ddff;">,</span><span style="color: #eeffe3;">cacheSize</span><span style="color: #89ddff;">)</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">    </span><span style="color: #c792ea; font-style: italic;">val </span><span style="color: #eeffe3;">client </span><span style="color: #89ddff;">= </span><span style="color: #ffcb6b;">OkHttpClient</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">Builder</span><span style="color: #89ddff;">().</span><span style="color: #82aaff;">apply </span><span style="color: #89ddff; font-weight: bold;">{</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff; font-weight: bold;">        </span><span style="color: #82aaff;">connectTimeout</span><span style="color: #89ddff;">(</span><span style="color: #f78c6c;">10</span><span style="color: #89ddff;">,</span><span style="color: #ffcb6b;">TimeUnit</span><span style="color: #89ddff;">.</span><span style="color: #eeffff;">SECONDS</span><span style="color: #89ddff;">)</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        </span><span style="color: #82aaff;">readTimeout</span><span style="color: #89ddff;">(</span><span style="color: #f78c6c;">10</span><span style="color: #89ddff;">,</span><span style="color: #ffcb6b;">TimeUnit</span><span style="color: #89ddff;">.</span><span style="color: #eeffff;">SECONDS</span><span style="color: #89ddff;">)</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        </span><span style="color: #82aaff;">writeTimeout</span><span style="color: #89ddff;">(</span><span style="color: #f78c6c;">10</span><span style="color: #89ddff;">,</span><span style="color: #ffcb6b;">TimeUnit</span><span style="color: #89ddff;">.</span><span style="color: #eeffff;">SECONDS</span><span style="color: #89ddff;">)</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        </span><span style="color: #82aaff;">addNetworkInterceptor</span><span style="color: #89ddff;">(</span><span style="color: #eeffff;">cacheinterceptor</span><span style="color: #89ddff;">)</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        </span><span style="color: #82aaff;">cache</span><span style="color: #89ddff;">(</span><span style="color: #eeffe3;">cache</span><span style="color: #89ddff;">)</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">    </span><span style="color: #89ddff; font-weight: bold;">}</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">build</span><span style="color: #89ddff;">()</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><br/></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">    </span><span style="color: #c792ea; font-style: italic;">val </span><span style="color: #eeffe3;">retrofit </span><span style="color: #89ddff;">= </span><span style="color: #ffcb6b;">Retrofit</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">Builder</span><span style="color: #89ddff;">().</span><span style="color: #82aaff;">apply </span><span style="color: #89ddff; font-weight: bold;">{</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff; font-weight: bold;">        </span><span style="color: #82aaff;">baseUrl</span><span style="color: #89ddff;">(</span><span style="color: #c3e88d;">"</span><a href="https://www.apiopen.top/" style="color: #c3e88d;">https://www.apiopen.top/</a><span style="color: #c3e88d;">"</span><span style="color: #89ddff;">)</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        </span><span style="color: #82aaff;">client</span><span style="color: #89ddff;">(</span><span style="color: #eeffe3;">client</span><span style="color: #89ddff;">)</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        </span><span style="color: #82aaff;">addConverterFactory</span><span style="color: #89ddff;">(</span><span style="color: #ffcb6b;">GsonConverterFactory</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">create</span><span style="color: #89ddff;">())</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        </span><span style="color: #82aaff;">addCallAdapterFactory</span><span style="color: #89ddff;">(</span><span style="color: #ffcb6b;">RxJava2CallAdapterFactory</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">create</span><span style="color: #89ddff;">())</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">    </span><span style="color: #89ddff; font-weight: bold;">}</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">build</span><span style="color: #89ddff;">()</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><br/></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">    </span><span style="color: #c792ea; font-style: italic;">val </span><span style="color: #eeffe3;">api </span><span style="color: #89ddff;">= </span><span style="color: #eeffe3;">retrofit</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">create</span><span style="color: #89ddff;">(</span><span style="color: #c3e88d; font-style: italic;">Api</span>::<span style="color: #c792ea; font-style: italic;">class</span><span style="color: #89ddff;">.</span><span style="color: #eeffff; font-style: italic;">java</span><span style="color: #89ddff;">)</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">    </span><span style="color: #c792ea; font-style: italic;">val </span><span style="color: #eeffe3;">call </span><span style="color: #89ddff;">= </span><span style="color: #eeffe3;">api</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">getNewsData</span><span style="color: #89ddff;">()</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">    </span><span style="color: #eeffe3;">call</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">subscribeOn</span><span style="color: #89ddff;">(</span><span style="color: #ffcb6b;">Schedulers</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">io</span><span style="color: #89ddff;">())</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        .</span><span style="color: #82aaff;">observeOn</span><span style="color: #89ddff;">(</span><span style="color: #ffcb6b;">AndroidSchedulers</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">mainThread</span><span style="color: #89ddff;">())</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        .</span><span style="color: #82aaff;">subscribe</span><span style="color: #89ddff;">(</span><span style="color: #c792ea; font-style: italic;">object </span>:<span style="color: #c3e88d; font-style: italic;">Observer</span><span style="color: #89ddff;">&lt;</span><span style="color: #ffcb6b;">NewsBean</span><span style="color: #89ddff;">&gt;{</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">            </span><span style="color: #c792ea; font-style: italic;">override fun </span><span style="color: #82aaff;">onComplete</span><span style="color: #89ddff;">() {</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><br/></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">            }</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><br/></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">            </span><span style="color: #c792ea; font-style: italic;">override fun </span><span style="color: #82aaff;">onSubscribe</span><span style="color: #89ddff;">(</span><span style="color: #f78c6c;">d</span>: <span style="color: #c3e88d; font-style: italic;">Disposable</span><span style="color: #89ddff;">) {</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><br/></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">            }</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><br/></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">            </span><span style="color: #c792ea; font-style: italic;">override fun </span><span style="color: #82aaff;">onNext</span><span style="color: #89ddff;">(</span><span style="color: #f78c6c;">t</span>: <span style="color: #ffcb6b;">NewsBean</span><span style="color: #89ddff;">) {</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">                </span><span style="color: #82aaff;">log</span><span style="color: #89ddff;">(</span><span style="color: #f78c6c;">t</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">getNews</span><span style="color: #89ddff;">())</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">            }</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><br/></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">            </span><span style="color: #c792ea; font-style: italic;">override fun </span><span style="color: #82aaff;">onError</span><span style="color: #89ddff;">(</span><span style="color: #f78c6c;">e</span>: <span style="color: #ffcb6b;">Throwable</span><span style="color: #89ddff;">) {</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><br/></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">            }</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        })</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">}</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><br/></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #c792ea; font-style: italic;">val </span><span style="color: #eeffff;">cacheinterceptor </span><span style="color: #89ddff;">= </span><span style="color: #c792ea; font-style: italic;">object </span>:<span style="color: #c3e88d; font-style: italic;">Interceptor</span><span style="color: #89ddff;">{</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">    </span><span style="color: #c792ea; font-style: italic;">override fun </span><span style="color: #82aaff;">intercept</span><span style="color: #89ddff;">(</span><span style="color: #f78c6c;">chain</span>: <span style="color: #c3e88d; font-style: italic;">Interceptor</span><span style="color: #89ddff;">.</span><span style="color: #c3e88d; font-style: italic;">Chain</span><span style="color: #89ddff;">)</span>: <span style="color: #ffcb6b;">Response </span><span style="color: #89ddff;">{</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        </span><span style="color: #c792ea; font-style: italic;">val </span><span style="color: #eeffe3;">request </span><span style="color: #89ddff;">= </span><span style="color: #f78c6c;">chain</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">request</span><span style="color: #89ddff;">()</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        </span><span style="color: #c792ea; font-style: italic;">val </span><span style="color: #eeffe3;">response </span><span style="color: #89ddff;">= </span><span style="color: #f78c6c;">chain</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">proceed</span><span style="color: #89ddff;">(</span><span style="color: #eeffe3;">request</span><span style="color: #89ddff;">)</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><br/></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        </span><span style="color: #c792ea; font-style: italic;">if</span><span style="color: #89ddff;">(</span><span style="color: #82aaff;">isNetworkConnected</span><span style="color: #89ddff;">(</span><span style="color: #c792ea; font-style: italic;">this</span><span style="color: #c3d3de;">@MainActivity</span><span style="color: #89ddff;">)){</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">            </span><span style="color: #c792ea; font-style: italic;">val </span><span style="color: #eeffe3;">max_age </span><span style="color: #89ddff;">= </span><span style="color: #f78c6c;">60 </span><span style="color: #717cb4; font-style: italic;">//</span><span style="color: #717cb4; font-style: italic; font-family: 'Menlo';">缓存时间</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #717cb4; font-style: italic; font-family: 'Menlo';">            </span><span style="color: #82aaff;">log</span><span style="color: #89ddff;">(</span><span style="color: #c3e88d;">"[???]"</span><span style="color: #89ddff;">)</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">            </span><span style="color: #c792ea; font-style: italic;">return </span><span style="color: #eeffe3;">response</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">newBuilder</span><span style="color: #89ddff;">()</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">                .</span><span style="color: #82aaff;">removeHeader</span><span style="color: #89ddff;">(</span><span style="color: #c3e88d;">"Pragma"</span><span style="color: #89ddff;">)</span></div><div style="background-color: rgb(15, 17, 26);"><span style="color: rgb(137, 221, 255); font-family: &quot;Fira Code&quot;; font-size: 12pt;">                .</span><span style="color: rgb(130, 170, 255); font-family: &quot;Fira Code&quot;; font-size: 12pt;">addHeader</span><span style="color: rgb(137, 221, 255); font-family: &quot;Fira Code&quot;; font-size: 12pt;">(</span><span style="color: rgb(195, 232, 141); font-family: &quot;Fira Code&quot;; font-size: 12pt;">"Cache-Control</span><font color="#c3e88d" face="Fira Code"><span style="caret-color: rgb(195, 232, 141); font-size: 16px;">”</span></font><font color="#89ddff" face="Fira Code"><span style="font-size: 12pt;">,</span></font><font color="#c3e88d" face="Fira Code"><span style="caret-color: rgb(195, 232, 141); font-size: 16px;">”</span><span style="font-size: 12pt;">public ,max-age="</span></font><span style="color: rgb(137, 221, 255); font-family: &quot;Fira Code&quot;; font-size: 12pt;">+</span><span style="color: rgb(238, 255, 227); font-family: &quot;Fira Code&quot;; font-size: 12pt;">max_age</span><span style="color: rgb(137, 221, 255); font-family: &quot;Fira Code&quot;; font-size: 12pt;">)</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">                .</span><span style="color: #82aaff;">build</span><span style="color: #89ddff;">()</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        }</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        </span><span style="color: #c792ea; font-style: italic;">return </span><span style="color: #eeffe3;">response</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #eeffe3;">    </span><span style="color: #89ddff;">}</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">}</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><br/></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #c792ea; font-style: italic;">companion object</span><span style="color: #89ddff;">{</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><br/></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">    </span><span style="color: #c792ea; font-style: italic;">fun </span><span style="color: #82aaff;">isNetworkConnected</span><span style="color: #89ddff;">(</span><span style="color: #f78c6c;">context</span>: <span style="color: #ffcb6b;">Context</span><span style="color: #89ddff;">)</span>:<span style="color: #ffcb6b;">Boolean</span><span style="color: #89ddff;">{</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">        </span><span style="color: #c792ea; font-style: italic;">val </span><span style="color: #eeffe3;">connectivityManager </span><span style="color: #89ddff;">=</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">            </span><span style="color: #f78c6c;">context</span><span style="color: #89ddff;">.</span><span style="color: #82aaff;">getSystemService</span><span style="color: #89ddff;">(</span><span style="color: #ffcb6b;">Context</span><span style="color: #89ddff;">.</span><span style="color: #eeffff; font-style: italic;">CONNECTIVITY_SERVICE</span><span style="color: #89ddff;">) </span><span style="color: #c792ea; font-style: italic;">as </span><span style="color: #ffcb6b;">ConnectivityManager</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #ffcb6b;">        </span><span style="color: #c792ea; font-style: italic;">val </span><span style="color: #eeffe3;">networkInfo </span><span style="color: #89ddff;">= </span><span style="color: #eeffe3;">connectivityManager</span><span style="color: #89ddff;">.</span><span style="color: #eeffff; font-style: italic;">activeNetworkInfo</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #eeffff; font-style: italic;">        </span><span style="color: #c792ea; font-style: italic;">if</span><span style="color: #89ddff;">(</span><span style="color: #eeffe3;">networkInfo </span><span style="color: #89ddff;">!= </span><span style="color: #c792ea; font-style: italic;">null</span><span style="color: #89ddff;">)</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">            </span><span style="color: #c792ea; font-style: italic;">return </span><span style="color: #eeffe3;">networkInfo</span><span style="color: #89ddff;">.</span><span style="color: #eeffff; font-style: italic;">isAvailable</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #eeffff; font-style: italic;">        </span><span style="color: #c792ea; font-style: italic;">return false</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #c792ea; font-style: italic;">    </span><span style="color: #89ddff;">}</span></div><div style="background-color:rgb(15, 17, 26);color:rgb(195, 206, 227);font-family:&quot;Fira Code&quot;;font-size:12pt;"><span style="color: #89ddff;">}</span></div><div><span/></div><div><span><span/></span></div><div><span><span><br/></span></span></div><div>如果需要为接口设置单独的时间，也可以加入注解</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>@Headers("Cache-Control:public ,max-age=60”)</div></div><div><br/></div><div><span>在 Interceptor 中，获取到接口的请求头</span></div><div><span><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>String cacheControl =request.cacheControl().toString();</div></div><div><br/></div></body></html>